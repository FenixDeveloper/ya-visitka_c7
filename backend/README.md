# Проект **«Визитница»** (backend)

## Краткое описание проекта

**API для платформы-визитницы** (внутреннего сервиса Яндекс.Практикум, где студенты могут публиковать свои визитки, давать обратную связь (реакции, комментарии) и изучать визитки друг друга. Для бэкенда используется **Node.js** с **TypeScript** и библиотеки **Express**, **Mongoose**, **Passport.js**. Для хранения данных на бэкенде используется база данных **MongoDB**. Для загрузки файлов использутся **multer**. В проекте имеется **2 роли:** куратор и студент.

## Бриф

Ссылка на [БРИФ](https://concrete-web-bad.notion.site/3-7-32283a40b8fa4027b0b7ef0f6ef8b1a7) в notion.

## Описание API сервиса

`/api/auth`

**Назначение**: Роут для авторизации и получения access-token.

**Метод**: POST

На вход принимает **code** (строку). Роут не защищен авторизацией. При ошибке отправялет объект ошибки с полем error. При успешной регистрации отправляет **access-token**.

`/api/auth/get-user`

**Назначение**: Роут для получения юзера.

**Метод**: GET

В заголовке Authorization передается **токен**, роут защищен авторизацией. Отдает **объект** с полями:
**студент** - _id, name, email, cohort, photo, role.
**куратор** - email, role.
При ошибке отправялет объект ошибки с полем error.

`/users`

**Назначение**:

**Метод**: POST


`/users`

**Назначение**:

**Метод**: GET


`/users/:id`

**Назначение**:

**Метод**: PUT


`/comments`

**Назначение**: Получение куратором комментриев студентов.

**Метод**: GET

На вход принимает Query-параметры: **offset** (число, указывает, сколько комментрие необходимо пропустить), **limit** (число, сколько комментрив необходимо показать), **search** (строка, фильтр по Фамилии и Имени студента/его когорте/ email). В заголовке Authorization передается **токен**, т.к. роут защищен авторизацией. Отдает **объект** с 2-мя полями: **items -** массив объектов, представляющих собой комментрий пользователя заданной структуры, **total -** количество объектов в массиве реакций).


`/comments/:id`

**Назначение**: Удаление комментрия студента по id.

**Метод**: DELETE

На вход принимает **id** реакции (строку). В заголовке Authorization передается **токен**, т.к. роут защищен авторизацией. При ошибке отправялет объект ошибки с полем error. При успешном удалении комментария отправляет **статус 200**.


`/files`

**Назначение**:

**Метод**: POST


`/files/:filename`

**Назначение**:

**Метод**: GET


`/profiles`

**Назначение**:

**Метод**: GET


`/profiles/:id`

**Назначение**:

**Метод**: GET


`/profiles/:id`

**Назначение**: 

**Метод**: POST


`api/profiles/:id/reactions`

**Назначение**: Добавляет реакцию к профилю студента
- Query - параматры **limit** и **offset**; не обязательные; по дефолту **limit = 20**, **offset = 0**
- Params - **id** целевого профиля;
- body - ```{ 
              target: ключ из поля profile.info или null для профиля,
              "text": "string",  если это комментарий,
              "emotion":"string", если это эмоция
            }```

**Метод**: POST


`api/profiles/:id/reactions`

**Назначение**: Получение реакций профиля
- Query - параматры **limit** и **offset**; не обязательные; по дефолту **limit = 20**, **offset = 0**
- Params - **id** целевого профиля;
**Метод**: GET


`/healthcheck`

**Назначение**:

**Метод**: GET


## Коллекция Postman

Ссылка на [Коллекцию Postman](https://api.postman.com/collections/24756620-1f6d276d-f1fb-4166-86b3-6a841655342e?access_key=PMAT-01GXNSVYMSB40H7R511KVDP456), которую можно использовать для тестирования API. Для того, чтобы **войти в приложение, как куратор**, необходимо, чтобы email куратора был внесен в список CURATOR_LIST (.env-файл). После необходимо пройти по [ссылке](https://oauth.yandex.ru/authorize?response_type=code&client_id=6588f39ea0274d599d3c60fb10c53556) и войти как куратор. В адресной строке появится code, который необходимо использовать в теле запроса в Postman для получения access-token. Для того, чтобы **зайти в приложение в роли студента**, необходимо, чтобы студент был в базе (студенты добавляются куратором). Далее схема авторизации аналогична куратору

## Ссылка на Swagger

В корне проекта находится visitka-schema.yaml. Его можно использовать для загрузки в [Swagger](https://editor.swagger.io/)

## Инструкция по запуску проекта
**Требования к окружению**:
**Конфигурационные параметры, которые необходимо задать**:
**Конфигурации внешних инструментов**:

Для запуска проекта вам необходимо установить актуальную версию **Node.js** (не старше **15.x**), **MongoDB** и создать на сервере базу данных **MogoDB** сименем **visitka** .

## Запуск проекта

* Склонировать репозиторий и перейти в папку с проектном
```bash
git clone https://github.com/FenixDeveloper/ya-visitka_c7.git
```
* Перейти в ветку backend
```bash
git checkout backend
```
* Установить зависимости
```bash
npm install
```
* Добавить файл .env, заполнить по образцу файла .env.example

* Запустить проект - npm start, либо в корневой дирректории выполнить команду sudo docker compose up - что развернет контейнер с приложением и базой данных

## Frontend

Ссылка на [папку c frontend](https://github.com/FenixDeveloper/ya-visitka_c7/tree/main/frontend).
Папка находится в том же [репозитории](https://github.com/FenixDeveloper/ya-visitka_c7), что и backend.

## Доступ к приложению

**Frontend:** https://visitki-dev.team-7.practicum-team.ru

**Backend:** https://visitki-dev.team-7.practicum-team.ru/api

